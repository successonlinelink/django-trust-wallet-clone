{% load static %}
<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, viewport-fit=cover">
        <!-- font -->
        <link rel="stylesheet" href="{% static 'fonts/fonts.css' %}">
        <!-- Icons -->
        <link rel="stylesheet" href="{% static 'fonts/font-icons.css' %}">
        <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/swiper-bundle.min.css' %}">
        <link rel="stylesheet"type="text/css" href="{% static 'css/styles.css' %}"/>

        <!-- Favicon and Touch Icons  -->
        <link rel="shortcut icon" href="images/logo/48.png" />
        <link rel="apple-touch-icon-precomposed" href="images/logo/48.png" />

        <title>Quantum Financial Ledger(QFS)</title>

        <!-- Alert Messages CSS -->
        <style>
            /* Overlay background */
            .message-overlay {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            /* Each message box */
            .alert-message {
                padding: 14px 20px;
                border-radius: 10px;
                color: #fff;
                font-size: 15px;
                font-weight: 500;
                opacity: 0;
                transform: translateY(-10px);
                animation: fadeIn 0.3s forwards;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            }

            /* Different message types */
            .alert-success { background-color: #28a745; }
            .alert-error { background-color: #dc3545; }
            .alert-warning { background-color: #ffc107; color: #333; }
            .alert-info { background-color: #17a2b8; }

            @keyframes fadeIn {
                to {
                opacity: 1;
                transform: translateY(0);
                }
            }

            @keyframes fadeOut {
                to {
                opacity: 0;
                transform: translateY(-10px);
                }
            }
        </style>

    </head>

    <body id="content">
        <!-- preloade -->
        <!-- <div class="preload preload-container">
            <div class="preload-logo" style="background-image: url({% static 'images/logo/144.png' %})">
            <div class="spinner"></div>
            </div>
        </div> -->
        <!-- /preload --> 

        <!-- Header -->
        <div class="header-style2 fixed-top bg-menuDark">
            {% include 'includes/header.html' %}

        </div> 
        <!--  -->
        
        {% block content %}
            

        {% endblock content %}

        
        <!-- Footer Navbar -->
        <div class="menubar-footer footer-fixed">
            {% include 'includes/footer_navbar.html' %}
            
        </div>
    
        <!-- notification -->
        <div class="modal fade modalRight" id="notification">
            {% include 'includes/notification.html' %}
            
        </div>
        
        <!-- noti popup -->
        <!-- <div class="modal fade modalCenter" id="modalNoti">
            -- Accpet Notification --
             include 'includes/accpet_noti.html' 
           
        </div> -->


        <script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/jquery.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/swiper-bundle.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/carousel.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/apexcharts.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/chart.bundle.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/line-chart.js' %}"></script>

        <script type="text/javascript" src="{% static 'js/main.js' %}"></script>

        <!-- Location -->
        <script>
            const locationDiv = document.getElementById("location-details");

            window.onload = () => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(showLocation, checkError);
                } else {
                    locationDiv.innerText = "Your browser does not support location detection.";
                }
            };

            const checkError = (error) => {
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        locationDiv.innerText = "Please allow access to location.";
                    break;
                    case error.POSITION_UNAVAILABLE:
                        locationDiv.innerText = "Location information unavailable.";
                    break;
                    case error.TIMEOUT:
                        locationDiv.innerText = "Request to get location timed out.";
                    break;
                    default:
                        locationDiv.innerText = "An unknown error occurred.";
                }
            };

            const showLocation = async (position) => {
                try {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;

                    const response = await fetch(
                        `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`
                    );

                    const data = await response.json();

                    if (!data || !data.countryName) {
                        throw new Error("No data");
                    }

                    const city = data.city || data.locality || data.principalSubdivision || "";
                    const country = data.countryName || "";
                    locationDiv.innerText = `${city ? city + ', ' : ''}${country}`;
                } catch (err) {
                    locationDiv.innerText = "Could not retrieve location details.";
                    console.error("Error:", err);
                }
            };
        </script>

        <!-- Translator -->
        <script>
            // ðŸŒ 1. Try to detect language automatically
            document.addEventListener("DOMContentLoaded", () => {
                detectLanguageAndTranslate();
            });

            async function detectLanguageAndTranslate() {
                try {
                // âœ… Use a CORS-friendly IP API (no proxy needed)
                const response = await fetch("https://api.country.is/");
                const data = await response.json();
                const countryCode = data.country;
                const language = getLanguageByCountry(countryCode);
                console.log(`Detected Country: ${countryCode}, Language: ${language}`);

                if (language !== "en") translatePage(language);
                } catch (error) {
                console.warn("IP detection failed:", error);
                fallbackTranslation();
                }
            }

            // ðŸ—ºï¸ Country â†’ Language Map
            function getLanguageByCountry(countryCode) {
                const countryToLanguage = {
                US: "en", GB: "en", CA: "en", AU: "en", NZ: "en",
                ES: "es", FR: "fr", DE: "de", IT: "it", PT: "pt",
                JP: "ja", CN: "zh", KR: "ko", BR: "pt", RU: "ru",
                AR: "es", MX: "es", NL: "nl", SE: "sv", NO: "no",
                DK: "da", FI: "fi", PL: "pl", TR: "tr", GR: "el",
                CZ: "cs", HU: "hu", RO: "ro", BG: "bg", IN: "hi",
                SA: "ar", AE: "ar", IL: "he", TH: "th", VN: "vi",
                ID: "id", PH: "tl", PK: "ur", NG: "en"
                };
                return countryToLanguage[countryCode] || "en";
            }

            // ðŸˆ¹ Translation dictionary
            const translations = {
                es: {
                "welcome to our website": "Bienvenido a nuestro sitio web",
                "this content will be automatically translated based on your location.":
                    "Este contenido se traducirÃ¡ automÃ¡ticamente segÃºn su ubicaciÃ³n.",
                },
                fr: {
                "welcome to our website": "Bienvenue sur notre site web",
                "this content will be automatically translated based on your location.":
                    "Ce contenu sera automatiquement traduit en fonction de votre localisation.",
                },
                de: {
                "welcome to our website": "Willkommen auf unserer Website",
                "this content will be automatically translated based on your location.":
                    "Dieser Inhalt wird automatisch basierend auf Ihrem Standort Ã¼bersetzt.",
                },
                id: {
                "welcome to our website": "Selamat datang di situs web kami",
                "this content will be automatically translated based on your location.":
                    "Konten ini akan diterjemahkan secara otomatis berdasarkan lokasi Anda.",
                },
            };

            // ðŸ”„ Translation logic
            function translatePage(targetLanguage) {
                console.log("Translating page to:", targetLanguage);
                const langData = translations[targetLanguage];
                if (!langData) return;

                document
                .querySelectorAll("h1, h2, h3, p, span, div, a, button, li, td, th, label")
                .forEach((el) => {
                    const text = el.textContent.trim().toLowerCase();
                    if (langData[text]) el.textContent = langData[text];

                    // Translate placeholder
                    if (el.placeholder && langData[el.placeholder.toLowerCase()]) {
                    el.placeholder = langData[el.placeholder.toLowerCase()];
                    }

                    // Translate title
                    if (el.title && langData[el.title.toLowerCase()]) {
                    el.title = langData[el.title.toLowerCase()];
                    }
                });
            }

            // ðŸŒ Fallback using browser language
            function fallbackTranslation() {
                const browserLang = (navigator.language || "en").split("-")[0];
                console.log("Fallback to browser language:", browserLang);
                if (browserLang !== "en") translatePage(browserLang);
            }

            // ðŸ§­ Manual override
            document.getElementById("retranslate").addEventListener("click", () => {
                const lang = prompt("Enter language code (e.g., 'es' for Spanish, 'fr' for French, 'de' for German):");
                if (lang) translatePage(lang.toLowerCase());
            });
        </script>

        <!-- Phone IP -->
        <script>
            // ðŸ§  Get user IP address using ipapi.co (free)
            fetch("https://ipapi.co/json/")
            .then(response => response.json())
            .then(data => {
                document.getElementById("ip").textContent = data.ip;
            })
            .catch(() => {
                document.getElementById("ip").textContent = "Unable to fetch IP.";
            });

            // ðŸ“± Detect device type
            function getDeviceType() {
                const ua = navigator.userAgent;
                if (/mobile/i.test(ua)) return "Mobile Phone";
                if (/tablet/i.test(ua)) return "Tablet";
                return "Desktop / Laptop";
            }

            document.getElementById("device").textContent = getDeviceType();
        </script>

        <!-- Alert Messages Script -->
        <script>
            // Function to show Django messages as overlay alerts
            function showOverlayMessages() {
                const overlay = document.createElement("div");
                overlay.classList.add("message-overlay");
                document.body.appendChild(overlay);

                {% if messages %}
                    {% for message in messages %}
                        const msgBox = document.createElement("div");
                        msgBox.classList.add("alert-message", "alert-{{ message.tags }}");
                        msgBox.textContent = "{{ message }}";
                        overlay.appendChild(msgBox);

                        // Automatically hide after 3 seconds
                        setTimeout(() => {
                        msgBox.style.animation = "fadeOut 0.3s forwards";
                        setTimeout(() => msgBox.remove(), 300);
                        }, 3000);
                    {% endfor %}

                    // Remove overlay if no messages remain
                    setTimeout(() => {
                        if (overlay.children.length === 0) overlay.remove();
                    }, 3500);
                {% endif %}
            }

            document.addEventListener("DOMContentLoaded", showOverlayMessages);
        </script>


    </body>

</html>